<div class="offnavs"></div>
<div class="container top">
  <div class="row">
    <div class="col-lg-1"></div>
    <div class="col-lg-4 bottom">
      <% if user_signed_in? %>
        <% if @beer.user == current_user.admin? %>
          <%= link_to edit_beer_path (@beer) do  %>
            <div class="card shadow">
              <p class='center target-top-title card-text'><%= @beer.name.upcase %></p>
              <p class='center'><%= @beer.style.name %> | by : <%= @beer.user.username %></p>
              <%= cl_image_tag @beer.photo.key, height: 300, width: 400, crop: :fill, class: 'card-img-top img-responsive beer-image' %>
              <div class="card-infos">
                <p class='card-text center'>Category: <%= @beer.category.name %></p>
                <p class='card-text center'>Alcool: <%= @beer.alcohol_level %> % Vol</p>
                <p class='card-text center'>Color: <%= @beer.color %> EBC</p>
                <p class='card-text center'>Bitterness: <%= @beer.bitterness %> IBU</p>
                <p class='card-text center'>Moyenne des notes: <%= @beer.average_stars %></p>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="card shadow">
            <p class='center target-top-title card-text'><%= @beer.name.upcase %></p>
            <p class='center'><%= @beer.style.name %> | by : <% @beer.user.username %></p>
            <%= cl_image_tag @beer.photo.key, height: 300, width: 400, crop: :fill, class: 'card-img-top img-responsive beer-image' %>
            <div class="card-infos">
              <p class='card-text center'>Category: <%= @beer.category.name %></p>
              <p class='card-text center'>Alcool: <%= @beer.alcohol_level %> % Vol</p>
              <p class='card-text center'>Color: <%= @beer.color %> EBC</p>
              <p class='card-text center'>Bitterness: <%= @beer.bitterness %> IBU</p>
              <p class='card-text center rate'><%= @beer.average_stars %></p>
              <% if @beer.fancies.nil? %>
                <%= simple_form_for([ @beer, @fancy ]) do |f| %>
                  <div class="modern">
                    <%= f.input :heart, as: :boolean, label: "à goûter", input_html: { class: "toggle" }  %>
                  </div>
                  <p class='card-text center'><%= f.button :submit, "Valider" %></p>
                <% end %>
              <% end %>
              <% a = [] %>
              <% if @beer.fancies.present? %>
                <% @beer.fancies.each do |bf| %>
                  <% if bf.user == current_user %>
                    <% a << bf %>
                  <% end %>
                <% end %>
              <% end %>
              <% if a.present? %>
                <p class='card-text center'><i class="fa fa-heart"></i></p>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="col-lg-1"></div>
    <div class="col-lg-6">
      <div class='card-show bottom'>
        <div class="row steps">
          <h2>Etapes de la Recette</h2>
        </div>
        <% if @beer.user == current_user && @beer.user.admin? %>
          <div class="row steps">
            <%= link_to 'Nouvelle étape', new_beer_recipe_path(@beer) %>
          </div>
        <% else %>
          <p class="card-text">Recette en cours d'édition</p>
        <% end %>
        <% s = @beer.recipes.sort_by { |step| step[:step] } %>
        <% s.each do |r| %>
          <div class="container">
            <%= link_to edit_beer_recipe_path(@beer, r) do %>
              <div class="row steps">
                <p class="step"><%= r.step %> - <%= r.action.name %>
                  <% if r.product_type.present? %>
                    <% if r.product_type.name == 'eau' %>
                      l'<%= r.product_type.name %>
                    <% elsif r.product_type.name == 'épices' %>
                      l'<%= r.product_type.name %>
                    <% elsif r.product_type.name == 'adjuvants' %>
                      l'<%= r.product_type.name %>
                    <% elsif r.product_type.name == 'houblon' %>
                      le <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'malt' %>
                      le <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'moût' %>
                      le <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'sucre' %>
                      le <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'fruit' %>
                      le <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'adjuvants' %>
                      les <%= r.product_type.name %>
                    <% elsif r.product_type.name == 'Drêches' %>
                      les <%= r.product_type.name %> avec
                    <% else %>
                      la <%= r.product_type.name %>
                    <% end %>
                  <% end %>
                  <% if r.product.present? %>
                    <%= r.product %>
                  <% end %>
                  <% if r.quantity.present? %>
                    ( <%= r.quantity %>
                  <% end %>
                  <% if r.unit.present? %>
                    <%= r.unit.name %> )
                  <% end %>
                  <% if r.temperature.present? %>
                    à <%= r.temperature %> °C
                  <% end %>
                  <% if r.duration.present? %>
                    pendant <%= r.duration %>
                  <% end %>
                  <% if r.duration_unit.present? %>
                     <%= r.duration_unit.name %>
                  <% end %>
                </p>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-1"></div>
    <div class="col-lg-11">
      <div class="card">
        <p class="center top">DESCRIPTION</p>
        <p class="description"> <%= @beer.description %> </p>
        <% if user_signed_in? %>
          <div class="center">
            <%= render 'tastings/form' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container bottom top">
  <div class="row">
    <% if @beer.tastings.present? %>
      <div class="col-lg-1"></div>
      <div class="col-lg-11">
        <% @beer.tastings.sort_by(&:id).reverse!.each do |b| %>
          <% if b.user == current_user %>
            <%= link_to edit_beer_tasting_path(@beer, b) do %>
              <div class="card bottom tasting-card">
                <% if b.user.photo.present? %>
                  <div class="user-card"><%= image_tag b.user.photo, height: 250, width: 250, crop: :fill, class: "tasting-user-img avatar-large" %>
                  </div>
                <% else %>
                  <div class="user-card"><%= cl_image_tag ('v1598080266/preservation_hall_jazz_band_isixvg.jpg'), height: 250, width: 250, crop: :fill, class: "tasting-user-img avatar-bordered" %>
                  </div>
                <% end %>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">NOTE GLOBALE :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text rate"><%= ('<i class="fa fa-star" aria-hidden="true"></i>' * b.global_rating + '<i class="fa fa-star-o" aria-hidden="true"></i>' * (5 - b.global_rating)).html_safe %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">COULEUR :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text"><%= b.design_color.name %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">BALANCE :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text"><%= b.balance.name %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">CLASSE :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text"><%= b.main_taste.name %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">TEMPS :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text"><%= b.weather.name %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">CONTEXTE :</p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-text"><%= b.context.name %></p>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">AROMES : </p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <div class="list">
                      <% b.flavours.each do |n| %>
                        | <%= n.name %> |
                      <% end %>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <p class="tasting-card-title">SENSATIONS : </p>
                  </div>
                  <div class='col-xs-6 col-sm-6 col-lg-6'>
                    <div class="list">
                      <% b.feelings.each do |n| %>
                        | <%= n.name %> |
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="card bottom tasting-card">
              <% if b.user.photo.present? %>
                <div class="user-card"><%= image_tag b.user.photo, height: 250, width: 250, crop: :fill, class: "tasting-user-img avatar-large" %></div>
              <% else %>
                <div class="user-card"><%= cl_image_tag ('v1598080266/preservation_hall_jazz_band_isixvg.jpg'), height: 250, width: 250, crop: :fill, class: "tasting-user-img avatar-bordered" %>
                </div>
              <% end %>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">NOTE GLOBALE :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text rate"><%= ('<i class="fa fa-star" aria-hidden="true"></i>' * b.global_rating + '<i class="fa fa-star-o" aria-hidden="true"></i>' * (5 - b.global_rating)).html_safe %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">COULEUR :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text"><%= b.design_color.name %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">BALANCE :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text"><%= b.balance.name %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">CLASSE :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text"><%= b.main_taste.name %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">TEMPS :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text"><%= b.weather.name %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">CONTEXTE :</p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-text"><%= b.context.name %></p>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">AROMES : </p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <div class="list">
                    <% b.flavours.each do |n| %>
                      | <%= n.name %> |
                    <% end %>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <p class="tasting-card-title">SENSATIONS : </p>
                </div>
                <div class='col-xs-6 col-sm-6 col-lg-6'>
                  <div class="list">
                    <% b.feelings.each do |n| %>
                      | <%= n.name %> |
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

